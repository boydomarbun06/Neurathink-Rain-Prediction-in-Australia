# -*- coding: utf-8 -*-
"""Untitled6.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1ybeQNy4xuLxHFxfxWw2-YNF3SdwXhL-R
"""

import streamlit as st
import pandas as pd
import numpy as np
import joblib

# 1. Load Model
@st.cache_resource
def load_model():
    return joblib.load('lightgbm_model.pkl')

model = load_model()

# Mengambil urutan fitur asli dari model (Penting agar tidak tertukar)
expected_features = model.feature_name_

# 2. UI Layout (Sesuai Foto Capture)
st.set_page_config(page_title="Neurathink : Rain Prediction App In Australia", layout="wide")
st.title("üåßÔ∏è Rain Tomorrow Prediction")
st.markdown("---")

# Menggunakan form agar aplikasi tidak reload setiap kali input berubah
with st.form("input_form"):
    col1, col2 = st.columns(2)

    with col1:
        location = st.selectbox[
    'Albury', 'BadgerysCreek', 'Cobar', 'CoffsHarbour', 'Moree', 'Newcastle',
    'NorahHead', 'NorfolkIsland', 'Penrith', 'Richmond', 'Sydney', 'SydneyAirport',
    'WaggaWagga', 'Williamtown', 'Wollongong', 'Canberra', 'Tuggeranong',
    'MountGinini', 'Ballarat', 'Bendigo', 'Sale', 'MelbourneAirport',
    'Melbourne', 'Mildura', 'Nhil', 'Portland', 'Watsonia', 'Dartmoor',
    'Brisbane', 'Cairns', 'GoldCoast', 'Townsville', 'Adelaide', 'MountGambier',
    'Nuriootpa', 'Woomera', 'Albany', 'Witchcliffe', 'PearceRAAF', 'PerthAirport',
    'Perth', 'SalmonGums', 'Walpole', 'Hobart', 'Launceston', 'AliceSprings',
    'Darwin', 'Katherine', 'Uluru'
]
        humidity_9am = st.number_input("Humidity 9am", 0.0, 100.0, 60.0)
        humidity_3pm = st.number_input("Humidity 3pm", 0.0, 100.0, 50.0)
        pressure_9am = st.number_input("Pressure 9am", 900.0, 1100.0, 1015.0)
        rainfall = st.number_input("Rainfall (mm)", 0.0, 500.0, 0.0)

    with col2:
        wind_gust_dir = st.selectbox("Wind Gust Direction", ["W", "NW", "N", "S", "SE", "E", "NE", "SW", "WNW", "NNW", "NNE", "SSE", "SSW", "ENE", "ESE", "WSW"])
        wind_dir_9am = st.selectbox("Wind Direction 9am", ["N", "NW", "NNW", "NNE", "S", "SE", "SW", "SSW", "E", "NE", "W", "WNW", "ESE", "ENE", "SSE", "WSW"])
        wind_dir_3pm = st.selectbox("Wind Direction 3pm", ["NW", "N", "NNW", "S", "SE", "SSW", "SW", "W", "WNW", "E", "NE", "NNE", "ESE", "ENE", "SSE", "WSW"])
        wind_diff = st.number_input("Wind Speed Difference", value=5.0)
        temp_range = st.number_input("Temp Range", value=10.0)

    rain_today = st.radio("Rain Today", ["No", "Yes"], horizontal=True)
    submit_button = st.form_submit_button("Predict Rain Tomorrow")

# 3. Logika Prediksi
if submit_button:
    # Buat DataFrame kosong dengan 64 kolom (semua nilai awal 0)
    input_df = pd.DataFrame(0, index=[0], columns=expected_features)

    # A. Isi Fitur Numerik
    input_df['Humidity3pm'] = humidity_3pm
    input_df['wind_diff'] = wind_diff
    input_df['Rainfall_log'] = np.log1p(rainfall)  # Sesuai notebook: np.log1p
    input_df['Pressure9am'] = pressure_9am
    input_df['TempRange'] = temp_range
    input_df['Humidity9am'] = humidity_9am
    input_df['RainToday_Yes'] = 1 if rain_today == "Yes" else 0

    # B. Isi Fitur Kategorikal (One-Hot Encoding Manual)
    cat_inputs = {
        'Location': location,
        'WindGustDir': wind_gust_dir,
        'WindDir9am': wind_dir_9am,
        'WindDir3pm': wind_dir_3pm
    }

    for feat, val in cat_inputs.items():
        col_name = f"{feat}_{val}"
        if col_name in input_df.columns:
            input_df[col_name] = 1

    # C. Eksekusi Prediksi
    prediction = model.predict(input_df)[0]
    probability = model.predict_proba(input_df)[0]

    # 4. Tampilkan Hasil
    st.markdown("---")
    if prediction == 1:
        st.error(f"### Hasil: BESOK HUJAN (YES)")
        st.write(f"Keyakinan Model: **{probability[1]:.2%}**")
    else:
        st.success(f"### Hasil: BESOK TIDAK HUJAN (NO)")
        st.write(f"Keyakinan Model: **{probability[0]:.2%}**")