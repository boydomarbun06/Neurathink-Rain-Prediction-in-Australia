# -*- coding: utf-8 -*-
"""Untitled6.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1ybeQNy4xuLxHFxfxWw2-YNF3SdwXhL-R
"""

import streamlit as st
import pandas as pd
import numpy as np
import joblib

# 1. Load Model
@st.cache_resource
def load_model():
    # Pastikan file lightgbm_model.pkl ada di folder yang sama
    return joblib.load('lightgbm_model.pkl')

model = load_model()

# Ambil daftar fitur yang diharapkan model (total 64 fitur berdasarkan metadata model)
expected_features = model.feature_name_

# 2. Konfigurasi UI (Sesuai Foto Capture)
st.set_page_config(page_title="Neurathink : Rain Prediction - Australia", layout="centered")

st.title("Rain Tomorrow Prediction in Australia")
st.markdown("---")

# Menggunakan kolom untuk merapikan layout sesuai gambar
col1, col2 = st.columns(2)

with col1:
    location = st.selectbox('Albury', 'BadgerysCreek', 'Cobar', 'CoffsHarbour', 'Moree', 'Newcastle',
    'NorahHead', 'NorfolkIsland', 'Penrith', 'Richmond', 'Sydney', 'SydneyAirport',
    'WaggaWagga', 'Williamtown', 'Wollongong', 'Canberra', 'Tuggeranong',
    'MountGinini', 'Ballarat', 'Bendigo', 'Sale', 'MelbourneAirport',
    'Melbourne', 'Mildura', 'Nhil', 'Portland', 'Watsonia', 'Dartmoor',
    'Brisbane', 'Cairns', 'GoldCoast', 'Townsville', 'Adelaide', 'MountGambier',
    'Nuriootpa', 'Woomera', 'Albany', 'Witchcliffe', 'PearceRAAF', 'PerthAirport',
    'Perth', 'SalmonGums', 'Walpole', 'Hobart', 'Launceston', 'AliceSprings',
    'Darwin', 'Katherine', 'Uluru')
    humidity_9am = st.number_input("Humidity 9am", min_value=0.0, max_value=100.0, value=60.0)
    humidity_3pm = st.number_input("Humidity 3pm", min_value=0.0, max_value=100.0, value=50.0)
    pressure_9am = st.number_input("Pressure 9am", min_value=900.0, max_value=1100.0, value=1015.0)
    rainfall = st.number_input("Rainfall (mm)", min_value=0.0, value=0.0)
    # Transformasi log sesuai notebook Anda
    rainfall_log = np.log1p(rainfall)

with col2:
    wind_gust_dir = st.selectbox("Wind Gust Direction", ["W", "NW", "N", "S", "SE", "E", "NE", "SW", "WNW", "NNW", "NNE", "SSE", "SSW", "ENE", "ESE", "WSW"])
    wind_dir_9am = st.selectbox("Wind Direction 9am", ["N", "NW", "NNW", "NNE", "S", "SE", "SW", "SSW", "E", "NE", "W", "WNW", "ESE", "ENE", "SSE", "WSW"])
    wind_dir_3pm = st.selectbox("Wind Direction 3pm", ["NW", "N", "NNW", "S", "SE", "SSW", "SW", "W", "WNW", "E", "NE", "NNE", "ESE", "ENE", "SSE", "WSW"])
    wind_diff = st.number_input("Wind Speed Difference", value=5.0)
    temp_range = st.number_input("Temp Range", value=10.0)

rain_today = st.radio("Rain Today", ["No", "Yes"], horizontal=True)

# 3. Prediksi Logic
if st.button("Predict Rain Tomorrow", type="primary"):
    # Buat template DataFrame dengan semua kolom 0
    input_df = pd.DataFrame(0, index=[0], columns=expected_features)

    # Mapping fitur numerik
    mapping_numeric = {
        'Humidity3pm': humidity_3pm,
        'wind_diff': wind_diff,
        'Rainfall_log': rainfall_log,
        'Pressure9am': pressure_9am,
        'TempRange': temp_range,
        'Humidity9am': humidity_9am,
        'RainToday_Yes': 1 if rain_today == "Yes" else 0
    }

    for col, val in mapping_numeric.items():
        if col in input_df.columns:
            input_df[col] = val

    # Mapping fitur kategorikal (One-Hot Encoding Manual)
    cat_inputs = {
        'Location': location,
        'WindGustDir': wind_gust_dir,
        'WindDir9am': wind_dir_9am,
        'WindDir3pm': wind_dir_3pm
    }

    for feat, val in cat_inputs.items():
        col_name = f"{feat}_{val}"
        if col_name in input_df.columns:
            input_df[col_name] = 1

    # Eksekusi Prediksi
    prediction = model.predict(input_df)[0]
    probability = model.predict_proba(input_df)[0][1]

    # 4. Tampilan Hasil
    st.markdown("---")
    if prediction == 1:
        st.error(f"### Result: YES, it will rain tomorrow (RainTomorrow)")
        st.write(f"Confidence Level: {probability:.2%}")
    else:
        st.success(f"### Result: NO, it will not rain tomorrow (RainTomorrow)")
        st.write(f"Confidence Level: {1 - probability:.2%}")

# Footer
st.caption("Model: LightGBM Classifier | Target: RainTomorrow")